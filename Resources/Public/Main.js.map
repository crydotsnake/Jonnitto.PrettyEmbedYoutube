{"version":3,"sources":["Embed.js","Popup.js","Preview.js","../../../node_modules/gator/gator.js"],"names":["replaceTag","element","tagName","let","originalElement","originalTag","startRX","RegExp","endRX","startSubst","endSubst","wrapper","document","createElement","innerHTML","outerHTML","replace","newElement","firstChild","parentNode","replaceChild","initVideo","link","embed","getAttribute","image","getElementsByTagName","imageSrc","width","height","fullscreen","setAttribute","classList","add","style","paddingTop","parseInt","closeModal","body","remove","VISIBLE_CLASS","setTimeout","$popup","fixPreview","img","src","naturalHeight","naturalWidth","indexOf","onload","_getMatcher","_matcher","matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector","Gator","matchesSelector","_matchesSelector","selector","boundElement","call","_level","_addHandler","gator","event","callback","_handlers","id","push","_removeHandler","i","length","splice","type","hasOwnProperty","_handleEvent","e","match","target","srcElement","j","_gatorInstances","matchesEvent","stopPropagation","cancelBubble","cancel","_bind","events","this","Array","addEvent","_getGlobalCallback","key","_id","prototype","on","off","preventDefault","useCapture","addEventListener","module","exports","window","prettyEmbedYoutubeRestore","removeAttribute","prettyEmbedYoutubeInit","links","test","navigator","userAgent","querySelectorAll","documentElement","const","HTML","BASE","MARKUP","popup","className","appendChild","getElementById","keyCode","contains","prettyEmbedYoutubeFixPreview","imgs"],"mappings":";;;;;yBAEA,SAASA,EAAWC,EAASC,GACzB,GAAuB,iBAAZD,GAA2C,iBAAZC,EAAsB,CAC5DC,IAAIC,EAAkBH,EAClBI,EAAcD,EAAgBF,QAC9BI,EAAU,IAAIC,OAAO,KAAOF,EAAa,KACzCG,EAAQ,IAAID,OAAOF,EAAc,KAAM,KACvCI,EAAa,IAAMP,EACnBQ,EAAWR,EAAU,IACrBS,EAAUC,SAASC,cAAc,OACrCF,EAAQG,UAAYV,EAAgBW,UAC/BC,QAAQV,EAASG,GACjBO,QAAQR,EAAOE,GACpBP,IAAIc,EAAaN,EAAQO,WAEzB,OADAjB,EAAQkB,WAAWC,aAAaH,EAAYhB,GACrCgB,GAIf,SAASI,EAAUC,GACfnB,IAAIoB,EAAQD,EAAKE,aAAa,gBAAiB,EAC3CC,EAAQH,EAAKI,qBAAqB,OAAO,GACzCC,EAAWF,EAAMD,aAAa,SAAU,EACxCI,EAAQH,EAAMG,MACdC,EAASJ,EAAMI,OACnB,GAAIN,GAASK,GAASC,EAAQ,CAC1B1B,IAAIF,EAAUD,EAAWsB,EAAM,OAC3BQ,EACgC,QAAhCR,EAAKE,aAAa,WAAuB,mBAAqB,GAElEvB,EAAQ8B,aAAa,WAAYJ,GACjC1B,EAAQ+B,UAAUC,IAAI,QACtBhC,EAAQiC,MAAMC,WAAaC,SAASP,GAAUO,SAASR,GAAS,IAAM,IACtE3B,EAAQa,UAAY,gBAAgBS,cAAiBK,eAAkBC,OAAWC,+BCf1F,SAASO,IACLzB,SAAS0B,KAAKN,UAAUO,OAAOC,GAC/BC,WAAW,WACPC,EAAO5B,UAAY,IACpB,KCrBP,SAAS6B,EAAWC,GAChBzC,IAAI0C,EAAMD,EAAIpB,aAAa,OAEvBoB,EAAIE,eAAiB,IACrBF,EAAIG,cAAgB,MACY,GAAhCF,EAAIG,QAAQ,kBAEZH,EAAMA,EACD7B,QAAQ,YAAa,WACrBA,QAAQ,YAAa,aACrBA,QAAQ,YAAa,aACrBA,QAAQ,gBAAiB,aAC9B4B,EAAIb,aAAa,MAAOc,GACxBJ,WAAW,WACPG,EAAIK,OAAS,WACTN,EAAWC,KAEhB,IACHH,WAAW,WACPE,EAAWC,IACZ,uFCYX,WA0BI,SAASM,EAAYjD,GACjB,OAAIkD,IAKAA,EADAlD,EAAQmD,QACGnD,EAAQmD,QAInBnD,EAAQoD,sBACGpD,EAAQoD,sBAInBpD,EAAQqD,mBACGrD,EAAQqD,mBAInBrD,EAAQsD,kBACGtD,EAAQsD,kBAInBtD,EAAQuD,iBACGvD,EAAQuD,iBAMZC,EAAMC,iBAYrB,SAASC,EAAiB1D,EAAS2D,EAAUC,GAGzC,GAAgB,SAAZD,EACA,OAAOC,EAKX,GAAI5D,IAAY4D,EAKhB,OAAIX,EAAYjD,GAAS6D,KAAK7D,EAAS2D,GAC5B3D,EAQPA,EAAQkB,YACR4C,IACOJ,EAAiB1D,EAAQkB,WAAYyC,EAAUC,SAF1D,EAMJ,SAASG,EAAYC,EAAOC,EAAON,EAAUO,GACpCC,EAAUH,EAAMI,MACjBD,EAAUH,EAAMI,QAGfD,EAAUH,EAAMI,IAAIH,KACrBE,EAAUH,EAAMI,IAAIH,OAGnBE,EAAUH,EAAMI,IAAIH,GAAON,KAC5BQ,EAAUH,EAAMI,IAAIH,GAAON,OAG/BQ,EAAUH,EAAMI,IAAIH,GAAON,GAAUU,KAAKH,GAG9C,SAASI,EAAeN,EAAOC,EAAON,EAAUO,GAI5C,GAAKC,EAAUH,EAAMI,IAMrB,GAAKH,EAWL,GAAKC,GAAaP,EAQlB,GAAKO,GAQL,GAAKC,EAAUH,EAAMI,IAAIH,GAAON,GAMhC,IAAK,IAAIY,EAAI,EAAGA,EAAIJ,EAAUH,EAAMI,IAAIH,GAAON,GAAUa,OAAQD,IAC7D,GAAIJ,EAAUH,EAAMI,IAAIH,GAAON,GAAUY,KAAOL,EAAU,CACtDC,EAAUH,EAAMI,IAAIH,GAAON,GAAUc,OAAOF,EAAG,GAC/C,mBAhBGJ,EAAUH,EAAMI,IAAIH,GAAON,QARlCQ,EAAUH,EAAMI,IAAIH,WAXpB,IAAK,IAAIS,KAAQP,EAAUH,EAAMI,IACzBD,EAAUH,EAAMI,IAAIO,eAAeD,KACnCP,EAAUH,EAAMI,IAAIM,OAsCpC,SAASE,EAAaR,EAAIS,EAAGH,GACzB,GAAKP,EAAUC,GAAIM,GAAnB,CAIA,IACIf,EACAmB,EAFAC,EAASF,EAAEE,QAAUF,EAAEG,WAGvB7B,KACAoB,EAAI,EACJU,EAAI,EAGRnB,EAAS,EACT,IAAKH,KAAYQ,EAAUC,GAAIM,GACvBP,EAAUC,GAAIM,GAAMC,eAAehB,KACnCmB,EAAQpB,EAAiBqB,EAAQpB,EAAUuB,EAAgBd,GAAIpE,WAElDwD,EAAM2B,aAAaT,EAAMQ,EAAgBd,GAAIpE,QAAS8E,EAAmB,SAAZnB,EAAqBkB,KAC3Ff,IACAK,EAAUC,GAAIM,GAAMf,GAAUmB,MAAQA,EACtC3B,EAAQW,GAAUK,EAAUC,GAAIM,GAAMf,IAWlD,IAJAkB,EAAEO,gBAAkB,WAChBP,EAAEQ,cAAe,GAGhBd,EAAI,EAAGA,GAAKT,EAAQS,IACrB,GAAIpB,EAAQoB,GACR,IAAKU,EAAI,EAAGA,EAAI9B,EAAQoB,GAAGC,OAAQS,IAAK,CACpC,IAAgD,IAA5C9B,EAAQoB,GAAGU,GAAGpB,KAAKV,EAAQoB,GAAGO,MAAOD,GAErC,YADArB,EAAM8B,OAAOT,GAIjB,GAAIA,EAAEQ,aACF,SAgBpB,SAASE,EAAMC,EAAQ7B,EAAUO,EAAU5B,cAIvC,GAAKmD,KAAKzF,QAAV,CAIMwF,aAAkBE,QACpBF,GAAUA,IAGTtB,GAAgC,uBACjCA,EAAWP,EACXA,EAAW,SAGf,IACIY,EADAH,EAAKqB,KAAKrB,GASd,IAAKG,EAAI,EAAGA,EAAIiB,EAAOhB,OAAQD,IACvBjC,EACAgC,EAAemB,EAAMD,EAAOjB,GAAIZ,EAAUO,IAIzCC,EAAUC,IAAQD,EAAUC,GAAIoB,EAAOjB,KACxCf,EAAMmC,SAASF,EAAMD,EAAOjB,GAbpC,SAA4BG,GACxB,OAAO,SAASG,GACZD,EAAaR,EAAIS,EAAGH,IAWYkB,CAAmBJ,EAAOjB,KAG9DR,EAAY0B,EAAMD,EAAOjB,GAAIZ,EAAUO,IAG3C,OAAOuB,MAQX,SAASjC,EAAMxD,EAASoE,GAGpB,KAAMqB,gBAAgBjC,GAAQ,CAM1B,IAAK,IAAIqC,KAAOX,EACZ,GAAIA,EAAgBW,GAAK7F,UAAYA,EACjC,OAAOkF,EAAgBW,GAO/B,OAHAC,IACAZ,EAAgBY,GAAO,IAAItC,EAAMxD,EAAS8F,GAEnCZ,EAAgBY,GAG3BL,KAAKzF,QAAUA,EACfyF,KAAKrB,GAAKA,EAnSd,IAAIlB,EACAY,EAAS,EACTgC,EAAM,EACN3B,KACAe,KA0SJ1B,EAAMuC,UAAUC,GAAK,SAASR,EAAQ7B,EAAUO,GAC5C,OAAOqB,EAAM1B,KAAK4B,KAAMD,EAAQ7B,EAAUO,IAW9CV,EAAMuC,UAAUE,IAAM,SAAST,EAAQ7B,EAAUO,GAC7C,OAAOqB,EAAM1B,KAAK4B,KAAMD,EAAQ7B,EAAUO,GAAU,IAGxDV,EAAMC,gBAAkB,aACxBD,EAAM8B,OAjTN,SAAiBT,GACbA,EAAEqB,iBACFrB,EAAEO,mBAgTN5B,EAAMmC,SA1TN,SAAmB3B,EAAOU,EAAMR,GAI5B,IAAIiC,EAAqB,QAARzB,GAA0B,SAARA,EACnCV,EAAMhE,QAAQoG,iBAAiB1B,EAAMR,EAAUiC,IAsTnD3C,EAAM2B,aAAe,WACjB,OAAO,GAG0BkB,EAAOC,UACxCD,UAAiB7C,GAGrB+C,OAAO/C,MAAQA,EA1UnB,KHSA+C,OAAOC,0BAA4B,SAASxG,GACxCE,IAAIyC,EAAM3C,EAAQuB,aAAa,cAAe,EAC1CoB,IACA3C,EAAQ+B,UAAUO,OAAO,QACzBtC,EAAQyG,gBAAgB,SACxBzG,EAAQa,UAAY,aAAa8B,SACjC5C,EAAWC,EAAS,OAI5BuG,OAAOG,uBAAyB,SAASC,GAErC,GACI,6CAA6CC,KAAKC,UAAUC,WAC9D,MACuB,IAAVH,IACPA,EAAQhG,SAASoG,iBAAiB,oBAEtC,IAAK7G,IAAIqE,EAAIoC,EAAMnC,OAAS,EAAGD,GAAK,EAAGA,IACnCnD,EAAUuF,EAAMpC,MAK5Bf,EAAM+C,QAAQP,GAAG,OAAQ,WACrBU,2BAIJlD,EAAM7C,SAASqG,iBAAiBhB,GAAG,QAAS,kBAlC5C,SAAmB/B,GACfA,EAAMiC,iBACN9E,EAAUqE,QCtCdwB,IAAMC,EAAOvG,SAASqG,gBAChBG,EAAO,6BACP5E,EAAgB4E,aAChBC,EAAS,iBACDD,mCACOA,+DAGjB1E,GAAS,EACT4E,EAAQ1G,SAASC,cAAc,OACnCyG,EAAMC,UAAYH,EAClBE,EAAMxG,UAAY,iBACJsG,gDACqBA,kEACEA,6BAyCrC3D,EAAM0D,GAAMlB,GAAG,QAAS,kBA/BxB,SAAmB/B,GACf/D,IAAI2B,EACgC,QAAhC4D,KAAKlE,aAAa,WAAuB,mBAAqB,GAC9DD,EAAQmE,KAAKlE,aAAa,gBAAiB,EAE1CkB,IACD9B,SAAS0B,KAAKkF,YAAYF,GAC1B5E,EAAS9B,SAAS6G,eAAe,kBAGjClG,IACA2C,EAAMiC,iBACNzD,EAAO5B,UAAYuG,EAAOrG,QAAQ,QAASO,GAAOP,QAC9C,OACAc,GAEJW,WAAW,WACP7B,SAAS0B,KAAKN,UAAUC,IAAIO,IAC7B,QAcXiB,EAAM0D,GAAMlB,GAAG,QAAS,IAAImB,EAAQ/E,GAGpCoB,EAAM0D,GAAMlB,GAAG,QAbf,SAAoB/B,GACK,IAAjBA,EAAMwD,UACkD,GAApD9G,SAAS0B,KAAKN,UAAU2F,SAASnF,IACjCH,MCzBZmE,OAAOoB,6BAA+B,SAASC,GAE3C,IACK,6CAA6ChB,KAAKC,UAAUC,WAC/D,MACsB,IAATc,IACPA,EAAOjH,SAASoG,iBACZ,sCAGR,IAAK7G,IAAIqE,EAAIqD,EAAKpD,OAAS,EAAGD,GAAK,EAAGA,IAClC7B,EAAWkF,EAAKrD,MAK5Bf,EAAM+C,QAAQP,GAAG,OAAQ,WACrB2B","file":"Main.js","sourcesContent":["import Gator from \"gator\";\n\nfunction replaceTag(element, tagName) {\n    if (typeof element === \"object\" && typeof tagName === \"string\") {\n        let originalElement = element;\n        let originalTag = originalElement.tagName;\n        let startRX = new RegExp(\"^<\" + originalTag, \"i\");\n        let endRX = new RegExp(originalTag + \">$\", \"i\");\n        let startSubst = \"<\" + tagName;\n        let endSubst = tagName + \">\";\n        let wrapper = document.createElement(\"div\");\n        wrapper.innerHTML = originalElement.outerHTML\n            .replace(startRX, startSubst)\n            .replace(endRX, endSubst);\n        let newElement = wrapper.firstChild;\n        element.parentNode.replaceChild(newElement, element);\n        return newElement;\n    }\n}\n\nfunction initVideo(link) {\n    let embed = link.getAttribute(\"data-embed\") || false;\n    let image = link.getElementsByTagName(\"img\")[0];\n    let imageSrc = image.getAttribute(\"src\") || false;\n    let width = image.width;\n    let height = image.height;\n    if (embed && width && height) {\n        let element = replaceTag(link, \"div\");\n        let fullscreen =\n            link.getAttribute(\"data-fs\") == \"true\" ? \"allowfullscreen \" : \"\";\n\n        element.setAttribute(\"data-img\", imageSrc);\n        element.classList.add(\"play\");\n        element.style.paddingTop = parseInt(height) / parseInt(width) * 100 + \"%\";\n        element.innerHTML = `<iframe src=\"${embed}\" width=\"${width}\" height=\"${height}\" ${fullscreen}frameborder=\"0\"></iframe>`;\n    }\n}\n\nfunction openVideo(event) {\n    event.preventDefault();\n    initVideo(this);\n}\n\nwindow.prettyEmbedYoutubeRestore = function(element) {\n    let img = element.getAttribute(\"data-img\") || false;\n    if (img) {\n        element.classList.remove(\"play\");\n        element.removeAttribute(\"style\");\n        element.innerHTML = `<img src=\"${img}\" />`;\n        replaceTag(element, \"a\");\n    }\n};\n\nwindow.prettyEmbedYoutubeInit = function(links) {\n    // We are on a mobile device without autoplay\n    if (\n        /Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)\n    ) {\n        if (typeof links === \"undefined\") {\n            links = document.querySelectorAll(\"a.embed-youtube\");\n        }\n        for (let i = links.length - 1; i >= 0; i--) {\n            initVideo(links[i]);\n        }\n    }\n};\n\nGator(window).on(\"load\", function() {\n    prettyEmbedYoutubeInit();\n});\n\n// Attach the events to the html tag (because of the Google Tag Manager)\nGator(document.documentElement).on(\"click\", \"a.embed-youtube\", openVideo);\n","import Gator from \"gator\";\n\nconst HTML = document.documentElement;\nconst BASE = \"jonnitto-prettyembed-popup\";\nconst VISIBLE_CLASS = `${BASE}-visible`;\nconst MARKUP = `\n<div class=\"${BASE}-holder\">\n    <iframe class=\"${BASE}-iframe\" src=\"%src%\" frameborder=\"0\"%fs%></iframe>\n</div>`;\n\nlet $popup = false;\nlet popup = document.createElement(\"div\");\npopup.className = BASE;\npopup.innerHTML = `\n<div class=\"${BASE}-inner\">\n    <button type=\"button\" class=\"${BASE}-close\">&times;</button>\n    <div id=\"popup-youtube\" class=\"${BASE}-content\"></div>\n</div>`;\n\nfunction closeModal() {\n    document.body.classList.remove(VISIBLE_CLASS);\n    setTimeout(function() {\n        $popup.innerHTML = \"\";\n    }, 300);\n}\n\nfunction openModal(event) {\n    let fullscreen =\n        this.getAttribute(\"data-fs\") == \"true\" ? \" allowfullscreen\" : \"\";\n    let embed = this.getAttribute(\"data-embed\") || false;\n\n    if (!$popup) {\n        document.body.appendChild(popup);\n        $popup = document.getElementById(\"popup-youtube\");\n    }\n\n    if (embed) {\n        event.preventDefault();\n        $popup.innerHTML = MARKUP.replace(\"%src%\", embed).replace(\n            \"%fs%\",\n            fullscreen\n        );\n        setTimeout(function() {\n            document.body.classList.add(VISIBLE_CLASS);\n        }, 100);\n    }\n}\n\nfunction closeOnESC(event) {\n    if (event.keyCode == 27) {\n        if (document.body.classList.contains(VISIBLE_CLASS) != -1) {\n            closeModal();\n        }\n    }\n}\n\n// Attach the events to the html tag (because of the Google Tag Manager)\nGator(HTML).on(\"click\", \"a.popup-youtube\", openModal);\nGator(HTML).on(\"click\", `.${BASE}`, closeModal);\n\n// Close on ESC\nGator(HTML).on(\"keyup\", closeOnESC);\n","import Gator from \"gator\";\n\nfunction fixPreview(img) {\n    let src = img.getAttribute(\"src\");\n    if (\n        img.naturalHeight <= 90 &&\n        img.naturalWidth <= 120 &&\n        src.indexOf(\"/default.jpg\") == -1\n    ) {\n        src = src\n            .replace(\"mqdefault\", \"default\")\n            .replace(\"hqdefault\", \"mqdefault\")\n            .replace(\"sddefault\", \"hqdefault\")\n            .replace(\"maxresdefault\", \"sddefault\");\n        img.setAttribute(\"src\", src);\n        setTimeout(function() {\n            img.onload = function() {\n                fixPreview(img);\n            };\n        }, 10);\n        setTimeout(function() {\n            fixPreview(img);\n        }, 5000);\n    }\n}\n\nwindow.prettyEmbedYoutubeFixPreview = function(imgs) {\n    // We are on not on a mobile device without autoplay\n    if (\n        !/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)\n    ) {\n        if (typeof imgs === \"undefined\") {\n            imgs = document.querySelectorAll(\n                \"img.embed-youtube-youtube-preview\"\n            );\n        }\n        for (let i = imgs.length - 1; i >= 0; i--) {\n            fixPreview(imgs[i]);\n        }\n    }\n};\n\nGator(window).on(\"load\", function() {\n    prettyEmbedYoutubeFixPreview();\n});\n","/**\n * Copyright 2014 Craig Campbell\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * GATOR.JS\n * Simple Event Delegation\n *\n * @version 1.2.4\n *\n * Compatible with IE 9+, FF 3.6+, Safari 5+, Chrome\n *\n * Include legacy.js for compatibility with older browsers\n *\n *             .-._   _ _ _ _ _ _ _ _\n *  .-''-.__.-'00  '-' ' ' ' ' ' ' ' '-.\n * '.___ '    .   .--_'-' '-' '-' _'-' '._\n *  V: V 'vv-'   '_   '.       .'  _..' '.'.\n *    '=.____.=_.--'   :_.__.__:_   '.   : :\n *            (((____.-'        '-.  /   : :\n *                              (((-'\\ .' /\n *                            _____..'  .'\n *                           '-._____.-'\n */\n(function() {\n    var _matcher,\n        _level = 0,\n        _id = 0,\n        _handlers = {},\n        _gatorInstances = {};\n\n    function _addEvent(gator, type, callback) {\n\n        // blur and focus do not bubble up but if you use event capturing\n        // then you will get them\n        var useCapture = type == 'blur' || type == 'focus';\n        gator.element.addEventListener(type, callback, useCapture);\n    }\n\n    function _cancel(e) {\n        e.preventDefault();\n        e.stopPropagation();\n    }\n\n    /**\n     * returns function to use for determining if an element\n     * matches a query selector\n     *\n     * @returns {Function}\n     */\n    function _getMatcher(element) {\n        if (_matcher) {\n            return _matcher;\n        }\n\n        if (element.matches) {\n            _matcher = element.matches;\n            return _matcher;\n        }\n\n        if (element.webkitMatchesSelector) {\n            _matcher = element.webkitMatchesSelector;\n            return _matcher;\n        }\n\n        if (element.mozMatchesSelector) {\n            _matcher = element.mozMatchesSelector;\n            return _matcher;\n        }\n\n        if (element.msMatchesSelector) {\n            _matcher = element.msMatchesSelector;\n            return _matcher;\n        }\n\n        if (element.oMatchesSelector) {\n            _matcher = element.oMatchesSelector;\n            return _matcher;\n        }\n\n        // if it doesn't match a native browser method\n        // fall back to the gator function\n        _matcher = Gator.matchesSelector;\n        return _matcher;\n    }\n\n    /**\n     * determines if the specified element matches a given selector\n     *\n     * @param {Node} element - the element to compare against the selector\n     * @param {string} selector\n     * @param {Node} boundElement - the element the listener was attached to\n     * @returns {void|Node}\n     */\n    function _matchesSelector(element, selector, boundElement) {\n\n        // no selector means this event was bound directly to this element\n        if (selector == '_root') {\n            return boundElement;\n        }\n\n        // if we have moved up to the element you bound the event to\n        // then we have come too far\n        if (element === boundElement) {\n            return;\n        }\n\n        // if this is a match then we are done!\n        if (_getMatcher(element).call(element, selector)) {\n            return element;\n        }\n\n        // if this element did not match but has a parent we should try\n        // going up the tree to see if any of the parent elements match\n        // for example if you are looking for a click on an <a> tag but there\n        // is a <span> inside of the a tag that it is the target,\n        // it should still work\n        if (element.parentNode) {\n            _level++;\n            return _matchesSelector(element.parentNode, selector, boundElement);\n        }\n    }\n\n    function _addHandler(gator, event, selector, callback) {\n        if (!_handlers[gator.id]) {\n            _handlers[gator.id] = {};\n        }\n\n        if (!_handlers[gator.id][event]) {\n            _handlers[gator.id][event] = {};\n        }\n\n        if (!_handlers[gator.id][event][selector]) {\n            _handlers[gator.id][event][selector] = [];\n        }\n\n        _handlers[gator.id][event][selector].push(callback);\n    }\n\n    function _removeHandler(gator, event, selector, callback) {\n\n        // if there are no events tied to this element at all\n        // then don't do anything\n        if (!_handlers[gator.id]) {\n            return;\n        }\n\n        // if there is no event type specified then remove all events\n        // example: Gator(element).off()\n        if (!event) {\n            for (var type in _handlers[gator.id]) {\n                if (_handlers[gator.id].hasOwnProperty(type)) {\n                    _handlers[gator.id][type] = {};\n                }\n            }\n            return;\n        }\n\n        // if no callback or selector is specified remove all events of this type\n        // example: Gator(element).off('click')\n        if (!callback && !selector) {\n            _handlers[gator.id][event] = {};\n            return;\n        }\n\n        // if a selector is specified but no callback remove all events\n        // for this selector\n        // example: Gator(element).off('click', '.sub-element')\n        if (!callback) {\n            delete _handlers[gator.id][event][selector];\n            return;\n        }\n\n        // if we have specified an event type, selector, and callback then we\n        // need to make sure there are callbacks tied to this selector to\n        // begin with.  if there aren't then we can stop here\n        if (!_handlers[gator.id][event][selector]) {\n            return;\n        }\n\n        // if there are then loop through all the callbacks and if we find\n        // one that matches remove it from the array\n        for (var i = 0; i < _handlers[gator.id][event][selector].length; i++) {\n            if (_handlers[gator.id][event][selector][i] === callback) {\n                _handlers[gator.id][event][selector].splice(i, 1);\n                break;\n            }\n        }\n    }\n\n    function _handleEvent(id, e, type) {\n        if (!_handlers[id][type]) {\n            return;\n        }\n\n        var target = e.target || e.srcElement,\n            selector,\n            match,\n            matches = {},\n            i = 0,\n            j = 0;\n\n        // find all events that match\n        _level = 0;\n        for (selector in _handlers[id][type]) {\n            if (_handlers[id][type].hasOwnProperty(selector)) {\n                match = _matchesSelector(target, selector, _gatorInstances[id].element);\n\n                if (match && Gator.matchesEvent(type, _gatorInstances[id].element, match, selector == '_root', e)) {\n                    _level++;\n                    _handlers[id][type][selector].match = match;\n                    matches[_level] = _handlers[id][type][selector];\n                }\n            }\n        }\n\n        // stopPropagation() fails to set cancelBubble to true in Webkit\n        // @see http://code.google.com/p/chromium/issues/detail?id=162270\n        e.stopPropagation = function() {\n            e.cancelBubble = true;\n        };\n\n        for (i = 0; i <= _level; i++) {\n            if (matches[i]) {\n                for (j = 0; j < matches[i].length; j++) {\n                    if (matches[i][j].call(matches[i].match, e) === false) {\n                        Gator.cancel(e);\n                        return;\n                    }\n\n                    if (e.cancelBubble) {\n                        return;\n                    }\n                }\n            }\n        }\n    }\n\n    /**\n     * binds the specified events to the element\n     *\n     * @param {string|Array} events\n     * @param {string} selector\n     * @param {Function} callback\n     * @param {boolean=} remove\n     * @returns {Object}\n     */\n    function _bind(events, selector, callback, remove) {\n\n        // fail silently if you pass null or undefined as an alement\n        // in the Gator constructor\n        if (!this.element) {\n            return;\n        }\n\n        if (!(events instanceof Array)) {\n            events = [events];\n        }\n\n        if (!callback && typeof(selector) == 'function') {\n            callback = selector;\n            selector = '_root';\n        }\n\n        var id = this.id,\n            i;\n\n        function _getGlobalCallback(type) {\n            return function(e) {\n                _handleEvent(id, e, type);\n            };\n        }\n\n        for (i = 0; i < events.length; i++) {\n            if (remove) {\n                _removeHandler(this, events[i], selector, callback);\n                continue;\n            }\n\n            if (!_handlers[id] || !_handlers[id][events[i]]) {\n                Gator.addEvent(this, events[i], _getGlobalCallback(events[i]));\n            }\n\n            _addHandler(this, events[i], selector, callback);\n        }\n\n        return this;\n    }\n\n    /**\n     * Gator object constructor\n     *\n     * @param {Node} element\n     */\n    function Gator(element, id) {\n\n        // called as function\n        if (!(this instanceof Gator)) {\n            // only keep one Gator instance per node to make sure that\n            // we don't create a ton of new objects if you want to delegate\n            // multiple events from the same node\n            //\n            // for example: Gator(document).on(...\n            for (var key in _gatorInstances) {\n                if (_gatorInstances[key].element === element) {\n                    return _gatorInstances[key];\n                }\n            }\n\n            _id++;\n            _gatorInstances[_id] = new Gator(element, _id);\n\n            return _gatorInstances[_id];\n        }\n\n        this.element = element;\n        this.id = id;\n    }\n\n    /**\n     * adds an event\n     *\n     * @param {string|Array} events\n     * @param {string} selector\n     * @param {Function} callback\n     * @returns {Object}\n     */\n    Gator.prototype.on = function(events, selector, callback) {\n        return _bind.call(this, events, selector, callback);\n    };\n\n    /**\n     * removes an event\n     *\n     * @param {string|Array} events\n     * @param {string} selector\n     * @param {Function} callback\n     * @returns {Object}\n     */\n    Gator.prototype.off = function(events, selector, callback) {\n        return _bind.call(this, events, selector, callback, true);\n    };\n\n    Gator.matchesSelector = function() {};\n    Gator.cancel = _cancel;\n    Gator.addEvent = _addEvent;\n    Gator.matchesEvent = function() {\n        return true;\n    };\n\n    if (typeof module !== 'undefined' && module.exports) {\n        module.exports = Gator;\n    }\n\n    window.Gator = Gator;\n}) ();\n"]}